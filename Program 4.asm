	.ORIG x3000
	LEA R0, A
	PUTS
	LEA R0, AO
	PUTS
	LD R0, LF
	OUT
	LEA R0, B
	PUTS
	LEA R0, BO
	PUTS
	LD R0, LF
	OUT
	LEA R0, C
	PUTS
	LEA R0, CO
	PUTS
	LD R0, LF
	OUT
	LEA R0, P1
	PUTS
	JSR MAIN
AO	.STRINGZ "ooo"
BO	.STRINGZ "ooooo"
CO	.STRINGZ "oooooooo"
NEGA	.FILL x-41
NEGB	.FILL x-42
NEGC	.FILL x-43
INVA	.STRINGZ "Invalid move. Try again."
SAVELT	.FILL x0000
A	.STRINGZ "ROW A: "
B	.STRINGZ "ROW B: "
C	.STRINGZ "ROW C: "
LF	.FILL x000A
SAVENM	.FILL x0000
NEG30	.FILL x-30
P1	.STRINGZ "Player 1, choose a row and number of rocks: "
BD	.FILL x006F
PLYR	.FILL x0000
MAIN	JSR CHECKW
INP	GETC
	OUT
	ST R0, SAVELT
	GETC
	OUT
	ST R0, SAVENM
	LD R1, SAVELT
	LD R2, NEGA
	ADD R3, R1, R2
	BRnp NOA
	JSR SUBA
NOA	LD R2, NEGB
	ADD R3, R1, R2
	BRnp NOB
	JSR SUBB
NOB	LD R2, NEGC
	ADD R3, R1, R2
	BRnp NOC
	JSR SUBC
NOC	LD R0, LF
	OUT
	LEA R0, INVA
	PUTS
	LD R0, LF
	OUT
	LD R6, PLYR
	BRnp PY2
	LEA R0, P1
	PUTS
	BRnzp INP
PY2	LEA R0, P2
	PUTS
	BRnzp INP
DATE	JSR UPP
	BRnzp MAIN
SUBA	LD R1, SAVENM
	LD R2, NEG30
	ADD R1, R1, R2
	BRnz NOC
	LD R2, COUNTA
	NOT R1, R1
	ADD R1, R1, #1
	ADD R3, R2, R1
	BRn NOC
	ST R3, COUNTA
	BRnp STA
	JSR CHECKW
STA	LD R0, LF
	OUT
	OUT
	LEA R0, A
	PUTS
	LD R0, BD
	LD R3, COUNTA
	BRz STB
COPA	OUT
	ADD R3, R3, #-1
	BRnp COPA
STB	LD R0, LF
	OUT
	LEA R0, B
	PUTS
	LD R0, BD
	LD R3, COUNTB
	BRz STC
COPB	OUT
	ADD R3, R3, #-1
	BRnp COPB
STC	LD R0, LF
	OUT
	LEA R0, C
	PUTS
	LD R0, BD
	LD R3, COUNTC
	BRz DATE
COPC	OUT
	ADD R3, R3, #-1
	BRnp COPC
	BRnzp DATE
SUBB	LD R2, COUNTB
	LD R4, SAVENM
	LD R5, NEG30
	ADD R4, R4, R5
	BRnz NOC
	NOT R4, R4
	ADD R4, R4, #1
	ADD R5, R2, R4
	BRn NOC
	ST R5, COUNTB
	ADD R5, R5, #0
	BRnp STA2
	JSR CHECKW
STA2	LD R0, LF
	OUT
	OUT
	LEA R0, A
	PUTS
	LD R0, BD
	LD R3, COUNTA
	BRz STB2
COA2	OUT
	ADD R3, R3, #-1
	BRnp COA2
STB2	LD R0, LF
	OUT
	LEA R0, B
	PUTS
	LD R0, BD
	LD R5, COUNTB
	BRz STC2
COB2	OUT
	ADD R5, R5, #-1
	BRnp COB2
STC2	LD R0, LF
	OUT
	LEA R0, C
	PUTS
	LD R0, BD
	LD R3, COUNTC
	BRz GOOD
COC2	OUT
	ADD R3, R3, #-1
	BRnp COC2
GOOD	BRnzp DATE
SUBC	LD R1, COUNTC
	LD R2, SAVENM
	LD R3, NEG30
	ADD R2, R2, R3
	BRnz NOC
	NOT R2, R2
	ADD R2, R2, #1
	ADD R3, R1, R2
	BRn NOC
	ST R3, COUNTC
	ADD R3, R3, #0
	BRnp STA3
	JSR CHECKW
STA3	LD R0, LF
	OUT
	OUT
	LEA R0, A
	PUTS
	LD R0, BD
	LD R4, COUNTA
	BRz STB3
COA3	OUT
	ADD R4, R4, #-1
	BRnp COA3
STB3	LD R0, LF
	OUT
	LEA R0, B
	PUTS
	LD R0, BD
	LD R4, COUNTB
	BRz STC3
COB3	OUT
	ADD R4, R4, #-1
	BRnp COB3
STC3	LD R0, LF
	OUT
	LEA R0, C
	PUTS
	LD R0, BD
	LD R3, COUNTC
	BRz GO1
COC3	OUT
	ADD R3, R3, #-1
	BRnp COC3
GO1	BRnzp DATE
CHECKW	LD R1, COUNTA
	BRz CHECKB
	RET
CHECKB	LD R2, COUNTB
	BRz CHECKC
	RET
CHECKC	LD R2, COUNTC
	BRz ALL
	RET
ALL	LD R0, LF
	OUT
	OUT
	LD R6, PLYR
	BRnp OTHER
	LEA R0, W2
	PUTS
	BRnzp END
OTHER	LEA R0, W1
	PUTS
END	HALT
UPP	LD R0, PLYR
	BRnp DIFF
	ADD R6, R6, #1
	LD R0, LF
	OUT
	LEA R0, P2
	PUTS
	ST R6, PLYR
	BRnzp BACK
DIFF	AND R6, R6, #0
	LD R0, LF
	OUT
	LEA R0, P1
	PUTS
	ST R6, PLYR
BACK	LEA R7, INP
	RET
COUNTA	.FILL x0003
COUNTB	.FILL x0005
COUNTC	.FILL x0008
P2	.STRINGZ "Player 2, choose a row and number of rocks: "
W1	.STRINGZ "Player 1 Wins."
W2	.STRINGZ "Player 2 Wins."
	.end